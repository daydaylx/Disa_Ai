/* ========================================
   Disa AI UI Theme â€“ Plan B Consolidated Sheet
   Tokens + component primitives for the entire UI layer
   ======================================== */

@import "./design-tokens.css";

@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  color-scheme: dark;

  /* Core surfaces & text - mapped from design tokens */
  --color-bg-900: var(--color-neutral-950);
  --color-bg-800: var(--color-neutral-900);
  --color-surface-100: var(--color-neutral-800);
  --color-surface-200: var(--color-neutral-700);
  --color-surface-300: var(--color-neutral-600);
  --color-border-strong: var(--color-neutral-400);
  --color-border-subtle: var(--color-neutral-300);
  --color-text-primary: var(--color-neutral-50);
  --color-text-secondary: var(--color-neutral-100);
  --color-text-muted: var(--color-neutral-200);

  /* Accent colors - single accent (cyan) with consistent opacity levels */
  --accent-500: var(--color-accent-500);
  --accent-600: color-mix(in srgb, var(--color-accent-500) 80%, var(--color-accent-700));
  --accent-700: var(--color-accent-700);
  --accent-outline: var(--color-accent-outline);
  --accent-disabled: color-mix(in srgb, var(--color-accent-700) 70%, var(--color-neutral-800));
  --accent-foreground: var(--color-accent-foreground);
  --accent-subtle: var(--color-accent-subtle);
  --accent-low: var(--color-accent-low);

  /* Semantic colors */
  --danger-500: var(--color-danger-500);
  --danger-600: color-mix(in srgb, var(--color-danger-500) 92%, black);
  --success-500: var(--color-success-500);
  --warning-500: var(--color-warning-500);
  --info-500: var(--color-info-500);

  /* Subtle background variants */
  --bg-success-subtle: color-mix(in srgb, var(--color-success-500) 12%, transparent);
  --bg-purple-subtle: color-mix(in srgb, var(--color-purple-500) 12%, transparent);
  --bg-danger-subtle: color-mix(in srgb, var(--color-danger-500) 12%, transparent);
  --bg-accent-subtle: var(--color-accent-subtle);
  --bg-accent-low: var(--color-accent-low);

  /* Focus ring & motion */
  --focus-ring-width: 3px;
  --focus-ring-offset: 2px;
  --focus-ring-color: color-mix(in srgb, var(--color-accent-500) 65%, transparent);
  --focus-ring-shadow: 0 0 0 var(--focus-ring-width) var(--focus-ring-color);

  --transition-fast: 160ms cubic-bezier(0.33, 1, 0.68, 1);
  --transition-normal: 220ms cubic-bezier(0.22, 1, 0.36, 1);
  --transition-slow: 280ms cubic-bezier(0.22, 1, 0.36, 1);

  /* Touch targets */
  --touch-target-min: 44px;
  --touch-target-roomy: 48px;

  /* Chat bubble color tokens */
  --bubble-assistant-bg: rgba(33, 45, 61, 0.9);
  --bubble-assistant-bg-secondary: rgba(23, 32, 45, 0.95);
  --bubble-assistant-border: rgba(98, 123, 153, 0.35);
  --bubble-assistant-text: var(--color-neutral-50);

  --bubble-user-bg: rgba(73, 119, 252, 0.95);
  --bubble-user-bg-secondary: rgba(58, 99, 225, 0.9);
  --bubble-user-text: var(--color-accent-foreground);
  --bubble-user-text-meta: rgba(255, 255, 255, 0.7);

  --bubble-typing-bg: rgba(25, 35, 51, 0.85);
  --bubble-typing-border: rgba(98, 123, 153, 0.25);

  --bubble-error-bg: rgba(83, 23, 27, 0.9);
  --bubble-error-border: rgba(255, 99, 132, 0.45);
  --bubble-error-text: var(--color-danger-100);

  /* Model picker color tokens */
  --model-chip-bg: rgba(26, 38, 55, 0.6);
  --model-chip-border: rgba(98, 123, 153, 0.4);
  --model-chip-text: rgba(185, 205, 230, 0.9);

  --model-favorite-bg: rgba(255, 199, 103, 0.1);
  --model-favorite-border: rgba(255, 199, 103, 0.6);
  --model-favorite-text: var(--color-warning-200);

  --model-free-bg: rgba(102, 212, 140, 0.15);
  --model-free-border: rgba(102, 212, 140, 0.6);
  --model-free-text: var(--color-success-200);

  --model-code-bg: rgba(127, 160, 255, 0.15);
  --model-code-border: rgba(127, 160, 255, 0.5);
  --model-code-text: var(--color-info-200);

  --model-cost-bg: rgba(255, 255, 255, 0.06);
  --model-cost-border: rgba(255, 255, 255, 0.2);
  --model-cost-text: rgba(255, 255, 255, 0.8);

  --model-banner-bg: rgba(255, 176, 31, 0.12);
  --model-banner-border: rgba(255, 176, 31, 0.4);
  --model-banner-bg-muted: rgba(19, 27, 40, 0.5);
  --model-banner-border-muted: rgba(98, 123, 153, 0.35);

  --model-empty-bg: rgba(19, 27, 40, 0.6);
  --model-empty-border: rgba(112, 138, 170, 0.4);

  /* Safety level tokens */
  --safety-free-bg: rgba(102, 212, 140, 0.12);
  --safety-free-border: rgba(102, 212, 140, 0.4);
  --safety-free-text: var(--color-success-200);

  --safety-moderate-bg: rgba(255, 176, 31, 0.12);
  --safety-moderate-border: rgba(255, 176, 31, 0.4);
  --safety-moderate-text: var(--color-warning-200);

  --safety-strict-bg: rgba(255, 99, 132, 0.12);
  --safety-strict-border: rgba(255, 99, 132, 0.5);
  --safety-strict-text: var(--color-strict-200);

  --safety-any-bg: rgba(98, 123, 153, 0.18);
  --safety-any-border: rgba(98, 123, 153, 0.4);
  --safety-any-text: rgba(185, 205, 230, 0.9);
}

:root[data-ui-theme="dark-glass"] {
  color-scheme: dark;

  --color-bg-900: var(--color-darkglass-bg);
  --color-bg-800: var(--color-darkglass-surface);
  --color-surface-100: color-mix(
    in srgb,
    var(--color-darkglass-surface) 92%,
    rgba(255, 255, 255, 0.05)
  );
  --color-surface-200: var(--color-darkglass-surface-elevated);
  --color-surface-300: color-mix(
    in srgb,
    var(--color-darkglass-surface-elevated) 86%,
    rgba(255, 255, 255, 0.12)
  );
  --color-border-strong: var(--color-darkglass-border-strong);
  --color-border-subtle: var(--color-darkglass-border-soft);
  --color-text-primary: var(--color-darkglass-text-primary);
  --color-text-secondary: var(--color-darkglass-text-secondary);
  --color-text-muted: var(--color-darkglass-text-muted);

  --accent-500: var(--color-darkglass-accent-teal);
  --accent-600: color-mix(
    in srgb,
    var(--color-darkglass-accent-teal) 68%,
    var(--color-darkglass-accent-violet)
  );
  --accent-700: var(--color-darkglass-accent-violet);
  --accent-outline: color-mix(in srgb, var(--color-darkglass-accent-violet) 42%, transparent);
  --accent-disabled: color-mix(
    in srgb,
    var(--color-darkglass-accent-violet) 28%,
    var(--color-darkglass-bg)
  );
  --accent-foreground: var(--color-darkglass-accent-foreground);
  --accent-subtle: color-mix(in srgb, var(--color-darkglass-accent-teal) 14%, transparent);
  --accent-low: color-mix(in srgb, var(--color-darkglass-accent-teal) 26%, transparent);

  --glass-bg-subtle: var(--color-darkglass-overlay-weak);
  --glass-bg-soft: var(--color-darkglass-overlay-soft);
  --glass-bg-medium: var(--color-darkglass-overlay-strong);
  --glass-bg-strong: color-mix(
    in srgb,
    var(--color-darkglass-overlay-strong) 92%,
    rgba(255, 255, 255, 0.08)
  );
  --glass-border-subtle: color-mix(in srgb, var(--color-darkglass-border-soft) 70%, transparent);
  --glass-border-soft: var(--color-darkglass-border-soft);
  --glass-border-medium: color-mix(in srgb, var(--color-darkglass-border-strong) 82%, transparent);
  --glass-border-strong: var(--color-darkglass-border-strong);
  --glass-tint-cyan: color-mix(in srgb, var(--color-darkglass-accent-teal) 16%, transparent);
  --glass-tint-purple: color-mix(in srgb, var(--color-darkglass-accent-violet) 14%, transparent);

  --focus-ring-color: color-mix(in srgb, var(--color-darkglass-accent-teal) 62%, transparent);
  --focus-ring-shadow: 0 0 0 var(--focus-ring-width) var(--focus-ring-color);

  --bg-success-subtle: color-mix(in srgb, var(--color-success-500) 14%, transparent);
  --bg-purple-subtle: color-mix(in srgb, var(--color-darkglass-accent-violet) 12%, transparent);
  --bg-danger-subtle: color-mix(in srgb, var(--color-danger-500) 14%, transparent);
  --bg-accent-subtle: color-mix(in srgb, var(--color-darkglass-accent-teal) 18%, transparent);
  --bg-accent-low: color-mix(in srgb, var(--color-darkglass-accent-teal) 26%, transparent);

  --bubble-assistant-bg: var(--color-darkglass-overlay-soft);
  --bubble-assistant-bg-secondary: color-mix(
    in srgb,
    var(--color-darkglass-overlay-strong) 80%,
    transparent
  );
  --bubble-assistant-border: var(--color-darkglass-border-soft);
  --bubble-assistant-text: var(--color-darkglass-text-primary);

  --bubble-user-bg: color-mix(
    in srgb,
    var(--color-darkglass-accent-teal) 72%,
    var(--color-darkglass-accent-violet)
  );
  --bubble-user-bg-secondary: color-mix(
    in srgb,
    var(--color-darkglass-accent-teal) 58%,
    var(--color-darkglass-accent-violet) 42%
  );
  --bubble-user-text: var(--color-darkglass-accent-foreground);
  --bubble-user-text-meta: rgba(8, 20, 28, 0.72);

  --bubble-typing-bg: color-mix(in srgb, var(--color-darkglass-overlay-soft) 92%, transparent);
  --bubble-typing-border: var(--color-darkglass-border-soft);

  --bubble-error-bg: color-mix(in srgb, var(--color-danger-500) 38%, rgba(11, 15, 20, 0.82));
  --bubble-error-border: color-mix(in srgb, var(--color-danger-500) 52%, transparent);
  --bubble-error-text: color-mix(
    in srgb,
    var(--color-darkglass-text-primary) 85%,
    var(--color-danger-subtle-tint)
  );

  --model-chip-bg: color-mix(in srgb, var(--color-darkglass-overlay-soft) 90%, transparent);
  --model-chip-border: color-mix(in srgb, var(--color-darkglass-border-soft) 88%, transparent);
  --model-chip-text: color-mix(in srgb, var(--color-darkglass-text-secondary) 92%, transparent);

  --model-favorite-bg: color-mix(in srgb, var(--color-warning-500) 18%, transparent);
  --model-favorite-border: color-mix(in srgb, var(--color-warning-500) 48%, transparent);
  --model-favorite-text: color-mix(in srgb, var(--color-warning-500) 82%, transparent);

  --model-free-bg: color-mix(in srgb, var(--color-success-500) 16%, transparent);
  --model-free-border: color-mix(in srgb, var(--color-success-500) 48%, transparent);
  --model-free-text: color-mix(in srgb, var(--color-success-500) 86%, transparent);

  --model-code-bg: color-mix(in srgb, var(--color-darkglass-accent-violet) 22%, transparent);
  --model-code-border: color-mix(in srgb, var(--color-darkglass-accent-violet) 50%, transparent);
  --model-code-text: color-mix(in srgb, var(--color-darkglass-accent-violet) 88%, transparent);

  --model-cost-bg: color-mix(in srgb, var(--color-darkglass-overlay-soft) 88%, transparent);
  --model-cost-border: color-mix(in srgb, var(--color-darkglass-border-soft) 90%, transparent);
  --model-cost-text: color-mix(in srgb, var(--color-darkglass-text-secondary) 88%, transparent);

  --model-banner-bg: color-mix(in srgb, var(--color-warning-500) 18%, transparent);
  --model-banner-border: color-mix(in srgb, var(--color-warning-500) 48%, transparent);
  --model-banner-bg-muted: color-mix(in srgb, var(--color-darkglass-overlay-soft) 88%, transparent);
  --model-banner-border-muted: color-mix(
    in srgb,
    var(--color-darkglass-border-soft) 86%,
    transparent
  );

  --model-empty-bg: color-mix(in srgb, var(--color-darkglass-overlay-soft) 94%, transparent);
  --model-empty-border: color-mix(in srgb, var(--color-darkglass-border-soft) 84%, transparent);

  .app-shell {
    background:
      radial-gradient(
        110% 120% at 12% 8%,
        color-mix(in srgb, rgb(var(--accent-teal-rgb)) 18%, transparent) 0%,
        transparent 70%
      ),
      radial-gradient(
        90% 110% at 88% 92%,
        color-mix(in srgb, rgb(var(--accent-violet-rgb)) 14%, transparent) 0%,
        transparent 75%
      ),
      var(--color-darkglass-bg);
  }

  .app-shell[data-reduced-motion="true"] {
    background: var(--color-darkglass-bg);
  }
}

@media (prefers-contrast: more) {
  :root {
    --color-border-strong: color-mix(
      in srgb,
      var(--color-neutral-400) 85%,
      var(--color-neutral-50)
    );
    --color-border-subtle: color-mix(
      in srgb,
      var(--color-neutral-300) 75%,
      var(--color-neutral-100)
    );
    --color-text-secondary: color-mix(
      in srgb,
      var(--color-neutral-100) 92%,
      var(--color-neutral-0)
    );
    --color-text-muted: color-mix(in srgb, var(--color-neutral-200) 88%, var(--color-neutral-0));
  }
}

@layer base {
  html,
  body,
  #root {
    min-height: 100svh;
  }

  body {
    margin: 0;
    background-color: var(--color-bg-800);
    color: var(--color-text-primary);
    font-family:
      "Inter",
      "Segoe UI",
      system-ui,
      -apple-system,
      sans-serif;
    font-size: 16px;
    line-height: 1.55;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin: 0;
    font-weight: 600;
    color: var(--color-text-primary);
  }

  h1 {
    font-size: 1.25rem;
    line-height: 1.3;
  }

  h2 {
    font-size: 1.125rem;
    line-height: 1.35;
  }

  p {
    margin: 0;
    line-height: 1.6;
  }

  a {
    color: inherit;
  }

  *:focus-visible {
    outline: none;
    box-shadow: var(--focus-ring-shadow);
  }

  ::selection {
    background-color: var(--accent-outline);
    color: var(--color-text-primary);
  }
}

@layer components {
  /* Background shell */
  .app-shell {
    background:
      radial-gradient(120% 120% at 16% 0%, rgba(34, 211, 238, 0.08), transparent 60%),
      radial-gradient(100% 120% at 80% 100%, rgba(34, 211, 238, 0.06), transparent 70%),
      var(--color-bg-800);
    min-height: 100svh;
  }

  .app-shell[data-reduced-motion="true"] {
    background: var(--color-bg-800);
  }

  /* Single glass utility */
  .glass-md {
    background-color: rgba(17, 30, 45, 0.62);
    border: 1px solid rgba(74, 117, 149, 0.35);
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
  }

  /* Buttons */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-1);
    min-height: var(--touch-target-min);
    padding: var(--space-2) var(--space-4);
    border-radius: var(--radius-md);
    font-size: 0.9375rem;
    font-weight: 500;
    line-height: 1;
    border: 1px solid transparent;
    background-color: transparent;
    color: var(--color-text-primary);
    transition:
      background-color var(--transition-fast),
      color var(--transition-fast),
      border-color var(--transition-fast),
      box-shadow var(--transition-fast),
      transform var(--transition-fast);
    cursor: pointer;
    user-select: none;
  }

  .btn:focus-visible {
    outline: none;
    box-shadow: var(--focus-ring-shadow);
  }

  .btn:disabled {
    cursor: not-allowed;
    opacity: 0.45;
  }

  .btn-primary {
    background-color: var(--accent-500);
    color: var(--accent-foreground);
    box-shadow:
      0 0 0 1px rgba(34, 211, 238, 0.35),
      var(--elevation-1);
  }

  .btn-primary:hover:not(:disabled) {
    background-color: var(--accent-600);
  }

  .btn-primary:active:not(:disabled) {
    background-color: var(--accent-700);
    transform: translateY(1px);
  }

  .btn-ghost {
    background-color: transparent;
    color: var(--color-text-secondary);
  }

  .btn-ghost:hover:not(:disabled) {
    background-color: rgba(255, 255, 255, 0.05);
    color: var(--color-text-primary);
  }

  .btn-ghost:active:not(:disabled) {
    background-color: rgba(255, 255, 255, 0.07);
  }

  .btn-danger {
    background-color: var(--danger-500);
    color: var(--color-text-primary);
  }

  .btn-danger:hover:not(:disabled) {
    background-color: var(--danger-600);
  }

  .btn-sm {
    min-height: var(--touch-target-min);
    padding: var(--space-1) var(--space-3);
    font-size: 0.8125rem;
  }

  .btn-lg {
    min-height: var(--touch-target-roomy);
    padding: var(--space-3) var(--space-6);
    font-size: 1rem;
  }

  /* Card family */
  .card {
    background-color: var(--color-surface-100);
    border: 1px solid var(--color-border-subtle);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    box-shadow: var(--elevation-0);
  }

  .card-elev1 {
    background-color: var(--color-surface-100);
    border: 1px solid var(--color-border-subtle);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    box-shadow: var(--elevation-1);
  }

  .card-elev2 {
    background-color: var(--color-surface-200);
    border: 1px solid var(--color-border-strong);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    box-shadow: var(--elevation-2);
  }

  .card-title {
    font-size: 1.125rem;
    line-height: 1.35;
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0;
  }

  .help {
    font-size: 0.8125rem;
    line-height: 1.4;
    color: var(--color-text-muted);
    margin: 0;
  }

  /* Form fields */
  .input,
  .select,
  .textarea {
    width: 100%;
    min-height: var(--touch-target-min);
    padding: var(--space-2) var(--space-3);
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border-subtle);
    background-color: var(--color-surface-200);
    color: var(--color-text-primary);
    font-size: 0.9375rem;
    transition:
      border-color var(--transition-fast),
      box-shadow var(--transition-fast),
      background-color var(--transition-fast);
  }

  .input::placeholder,
  .textarea::placeholder {
    color: var(--color-text-muted);
  }

  .input:focus,
  .select:focus,
  .textarea:focus {
    border-color: var(--accent-500);
    box-shadow: 0 0 0 3px var(--accent-outline);
    outline: none;
  }

  .input:disabled,
  .select:disabled,
  .textarea:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }

  .chip {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    min-height: var(--touch-target-min);
    padding: 0 var(--space-3);
    border-radius: var(--radius-full);
    border: 1px solid var(--color-border-subtle);
    background-color: var(--color-surface-100);
    color: var(--color-text-secondary);
    font-size: 0.875rem;
  }

  .chip-toggle {
    cursor: pointer;
    transition:
      background-color var(--transition-fast),
      color var(--transition-fast),
      border-color var(--transition-fast);
  }

  .chip-toggle:hover {
    border-color: var(--accent-400);
    color: var(--color-text-primary);
  }

  .chip-toggle--active {
    background-color: var(--accent-500);
    border-color: var(--accent-500);
    color: var(--accent-foreground);
  }

  .chip-toggle:focus-visible {
    outline: none;
    box-shadow: var(--focus-ring-shadow);
  }

  /* Navigation */
  .bottom-nav {
    background-color: rgba(11, 17, 24, 0.9);
    border: 1px solid rgba(61, 84, 107, 0.4);
    border-radius: calc(var(--radius-lg) + 4px);
    box-shadow: var(--elevation-1);
    padding: var(--space-1);
  }

  .nav-tab {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-1);
    min-height: var(--touch-target-roomy);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-text-muted);
    border: none;
    background: transparent;
    transition:
      background-color var(--transition-fast),
      color var(--transition-fast);
  }

  .nav-tab:hover {
    color: var(--color-text-primary);
    background-color: rgba(255, 255, 255, 0.05);
  }

  .nav-tab--active {
    color: var(--accent-foreground);
    background-color: var(--accent-500);
  }

  /* Chat bubbles */
  .chat-message {
    display: flex;
    align-items: flex-end;
    gap: var(--space-2);
    margin-bottom: var(--space-4);
  }

  .chat-message--user {
    justify-content: flex-end;
  }

  .chat-message--assistant {
    justify-content: flex-start;
  }

  .chat-message__avatar {
    align-self: flex-end;
  }

  .chat-message__body {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .chat-message__text {
    margin: 0;
    white-space: pre-wrap;
    color: inherit;
  }

  .chat-message__code {
    margin: 0;
  }

  .chat-typing {
    display: flex;
    align-items: flex-end;
    gap: var(--space-2);
    margin-bottom: var(--space-4);
  }

  .chat-bubble {
    position: relative;
    max-width: min(100%, var(--chat-bubble-max-width, 46ch));
    padding: var(--space-3) var(--space-5) var(--space-3) var(--space-4);
    border-radius: var(--radius-xl);
    font-size: 0.95rem;
    line-height: 1.6;
    word-break: break-word;
    box-shadow: var(--elevation-2);
    border: 1px solid transparent;
  }

  .chat-bubble--assistant {
    background: linear-gradient(
      145deg,
      var(--bubble-assistant-bg),
      var(--bubble-assistant-bg-secondary)
    );
    border-color: var(--bubble-assistant-border);
    color: var(--bubble-assistant-text);
  }

  .chat-bubble--user {
    background: linear-gradient(145deg, var(--bubble-user-bg), var(--bubble-user-bg-secondary));
    color: var(--bubble-user-text);
  }

  .chat-bubble--typing {
    background: var(--bubble-typing-bg);
    border-color: var(--bubble-typing-border);
    min-width: 120px;
  }

  .chat-bubble--error {
    background: var(--bubble-error-bg);
    border-color: var(--bubble-error-border);
    color: var(--bubble-error-text);
  }

  .chat-bubble__content {
    display: block;
  }

  .chat-bubble__meta {
    display: inline-flex;
    align-items: center;
    justify-content: flex-end;
    gap: var(--space-1);
    margin-top: var(--space-2);
    font-size: 0.75rem;
    color: var(--color-text-muted);
    width: 100%;
  }

  .chat-bubble--user .chat-bubble__meta {
    color: var(--bubble-user-text-meta);
  }

  .chat-bubble__timestamp {
    font-variant-numeric: tabular-nums;
  }

  .chat-bubble__status {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: inherit;
  }

  .chat-bubble__status--error {
    color: var(--danger-400);
  }

  .chat-bubble__copy {
    position: absolute;
    top: var(--space-2);
    right: var(--space-2);
    color: inherit;
    opacity: 0;
    transform: scale(0.98);
    transition:
      opacity var(--transition-fast),
      transform var(--transition-fast);
  }

  .chat-bubble:hover .chat-bubble__copy,
  .chat-bubble:focus-within .chat-bubble__copy {
    opacity: 1;
    transform: scale(1);
  }

  .chat-typing__dots {
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .chat-typing__dots span {
    width: 6px;
    height: 6px;
    border-radius: 9999px;
    background-color: currentColor;
    opacity: 0.4;
    animation: bubble-typing 1.2s infinite ease-in-out;
  }

  .chat-typing__dots span:nth-child(2) {
    animation-delay: 0.15s;
  }

  .chat-typing__dots span:nth-child(3) {
    animation-delay: 0.3s;
  }

  @keyframes bubble-typing {
    0%,
    80%,
    100% {
      transform: translateY(0);
      opacity: 0.4;
    }
    40% {
      transform: translateY(-3px);
      opacity: 1;
    }
  }

  .chat-error {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .chat-error__title {
    margin: 0;
    font-weight: 600;
    font-size: 0.9rem;
    color: inherit;
  }

  .chat-error__message {
    margin: 0;
    font-size: 0.85rem;
    line-height: 1.5;
    color: inherit;
  }

  .chat-error__actions {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  /* Code block */
  .code-block {
    border-radius: var(--radius-lg);
    border: 1px solid rgba(98, 123, 153, 0.35);
    background: rgba(20, 28, 41, 0.78);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
    overflow: hidden;
  }

  .chat-bubble--user .code-block {
    border-color: rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.1);
  }

  .code-block__toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-3);
    background: rgba(8, 12, 19, 0.6);
    border-bottom: 1px solid rgba(112, 138, 170, 0.25);
  }

  .chat-bubble--user .code-block__toolbar {
    background: rgba(255, 255, 255, 0.12);
    border-bottom-color: rgba(255, 255, 255, 0.2);
  }

  .code-block__meta {
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: rgba(177, 197, 221, 0.7);
  }

  .chat-bubble--user .code-block__meta {
    color: rgba(255, 255, 255, 0.85);
  }

  .code-block__actions {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .code-block__toggle {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    font-size: 0.75rem;
  }

  .code-block__toggle.is-active {
    background: rgba(98, 123, 153, 0.25);
  }

  .chat-bubble--user .code-block__toggle.is-active {
    background: rgba(255, 255, 255, 0.2);
  }

  .code-block__action-label {
    display: none;
  }

  /* Desktop-only features removed for mobile-first Android focus */

  .code-block__copy {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: var(--touch-target-min);
  }

  .code-block__pre {
    margin: 0;
    padding: var(--space-4);
    overflow-x: auto;
    font-family: "JetBrains Mono", "Fira Code", "SFMono-Regular", monospace;
    font-size: 0.85rem;
    line-height: 1.6;
    background: transparent;
  }

  .code-block__pre--wrap {
    white-space: pre-wrap;
    word-break: break-word;
  }

  .code-block__code {
    display: block;
  }

  .chat-empty-state {
    position: absolute;
    inset: var(--space-4) var(--space-4) auto var(--space-4);
    display: grid;
    gap: var(--space-3);
    border-radius: var(--radius-lg);
    border: 1px dashed rgba(112, 138, 170, 0.4);
    background: rgba(19, 27, 40, 0.6);
    padding: var(--space-4);
    color: var(--color-text-secondary);
  }

  .chat-empty-state__title {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text-primary);
  }

  .chat-empty-state__list {
    margin: 0;
    padding-left: var(--space-4);
    display: grid;
    gap: var(--space-2);
    font-size: 0.9rem;
  }

  /* Model picker */
  .model-picker {
    display: grid;
    gap: var(--space-4);
  }

  .model-picker__banner {
    border-radius: var(--radius-md);
    border: 1px solid var(--model-banner-border);
    background: var(--model-banner-bg);
    padding: var(--space-3);
    font-size: 0.8rem;
    color: var(--color-text-primary);
  }

  .model-picker__banner--muted {
    border-color: var(--model-banner-border-muted);
    background: var(--model-banner-bg-muted);
    color: var(--color-text-muted);
  }

  .model-picker__filters {
    display: grid;
    gap: var(--space-2);
  }

  .model-picker__search {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .model-picker__chips {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .model-picker__advanced {
    display: grid;
    gap: var(--space-2);
    grid-template-columns: 1fr;
    align-items: stretch;
  }

  .model-picker__field {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 0.75rem;
    color: var(--color-text-muted);
  }

  .model-picker__results {
    display: grid;
    gap: var(--space-2);
    max-height: 420px;
    overflow-y: auto;
    padding: var(--space-1);
  }

  .model-picker__empty {
    border-radius: var(--radius-lg);
    border: 1px dashed var(--model-empty-border);
    padding: var(--space-4);
    text-align: center;
    font-size: 0.9rem;
    color: var(--color-text-muted);
  }

  .model-picker__loading {
    display: grid;
    gap: var(--space-4);
    padding: var(--space-4);
    text-align: center;
  }

  .loading-skeleton {
    display: grid;
    gap: var(--space-2);
  }

  .skeleton-card {
    height: 120px;
    background: linear-gradient(
      90deg,
      var(--color-surface-100) 25%,
      var(--color-surface-200) 50%,
      var(--color-surface-100) 75%
    );
    background-size: 200% 100%;
    animation: skeleton-loading 1.5s infinite;
    border-radius: var(--radius-lg);
  }

  .loading-text {
    margin: 0;
    font-size: 0.9rem;
    color: var(--color-text-muted);
  }

  @keyframes skeleton-loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  .model-card {
    position: relative;
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-border-subtle);
    background: var(--color-surface-100);
    padding: var(--space-4);
    display: grid;
    gap: var(--space-3);
    cursor: pointer;
    transition:
      transform var(--transition-fast),
      border-color var(--transition-fast),
      box-shadow var(--transition-fast);
  }

  .model-card:hover {
    transform: translateY(-1px);
    border-color: var(--accent-400);
  }

  .model-card--active {
    border-color: var(--accent-500);
    box-shadow: var(--elevation-1);
  }

  .model-card__header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--space-2);
  }

  .model-card__title-group {
    min-width: 0;
  }

  .model-card__title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0;
    text-wrap: balance;
  }

  .model-card__subtitle {
    font-size: 0.8rem;
    color: var(--color-text-muted);
    margin-top: var(--space-1);
  }

  .model-card__favorite {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--touch-target-min);
    height: var(--touch-target-min);
    border-radius: var(--radius-full);
    border: 1px solid transparent;
    background: transparent;
    color: var(--color-text-muted);
    cursor: pointer;
    transition:
      color var(--transition-fast),
      border-color var(--transition-fast),
      background-color var(--transition-fast);
  }

  .model-card__favorite:hover {
    color: var(--accent-500);
  }

  .model-card__favorite:focus-visible {
    outline: none;
    box-shadow: var(--focus-ring-shadow);
  }

  .model-card__favorite--active {
    color: var(--accent-500);
  }

  .model-card__meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    font-size: 0.8rem;
    color: var(--color-text-muted);
  }

  .model-card__tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .model-chip {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    padding: 0 var(--space-3);
    min-height: var(--touch-target-min);
    border-radius: var(--radius-full);
    font-size: 0.75rem;
    background: var(--model-chip-bg);
    border: 1px solid var(--model-chip-border);
    color: var(--model-chip-text);
  }

  .model-chip--favorite {
    border-color: var(--model-favorite-border);
    background: var(--model-favorite-bg);
    color: var(--model-favorite-text);
  }

  .model-chip--free {
    border-color: var(--model-free-border);
    background: var(--model-free-bg);
    color: var(--model-free-text);
  }

  .model-chip--code {
    border-color: var(--model-code-border);
    background: var(--model-code-bg);
    color: var(--model-code-text);
  }

  .model-chip--cost {
    border-color: var(--model-cost-border);
    background: var(--model-cost-bg);
    color: var(--model-cost-text);
  }

  .model-chip--safety-free {
    border-color: var(--safety-free-border);
    background: var(--safety-free-bg);
    color: var(--safety-free-text);
  }

  .model-chip--safety-moderate {
    border-color: var(--safety-moderate-border);
    background: var(--safety-moderate-bg);
    color: var(--safety-moderate-text);
  }

  .model-chip--safety-strict {
    border-color: var(--safety-strict-border);
    background: var(--safety-strict-bg);
    color: var(--safety-strict-text);
  }

  .model-chip--safety-any {
    border-color: var(--safety-any-border);
    background: var(--safety-any-bg);
    color: var(--safety-any-text);
  }

  .settings-key-hint {
    border-radius: var(--radius-md);
    border: 1px solid rgba(98, 123, 153, 0.35);
    background: rgba(19, 27, 40, 0.45);
    color: var(--color-text-muted);
    font-size: 0.8rem;
  }

  .settings-key-error {
    border-radius: var(--radius-md);
    border: 1px solid rgba(255, 99, 132, 0.6);
    background: rgba(255, 99, 132, 0.12);
    color: var(--color-danger-200);
    font-size: 0.85rem;
  }

  .scroll-container {
    overflow-y: auto;
    scroll-behavior: smooth;
  }

  .safe-bottom {
    padding-bottom: max(var(--space-2), env(safe-area-inset-bottom));
  }

  .safe-top {
    padding-top: max(var(--space-2), env(safe-area-inset-top));
  }

  .skip-link {
    position: absolute;
    left: var(--space-4);
    top: -200%;
    z-index: 100;
    padding: var(--space-2) var(--space-4);
    background-color: var(--accent-500);
    color: var(--accent-foreground);
    border-radius: var(--radius-md);
    font-weight: 600;
    transition: top var(--transition-fast);
  }

  .skip-link:focus-visible {
    top: var(--space-4);
  }
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  .tap-target {
    min-height: var(--touch-target-min);
    min-width: var(--touch-target-min);
  }

  .tap-target-roomy {
    min-height: var(--touch-target-roomy);
    min-width: var(--touch-target-roomy);
  }
}

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  .app-shell {
    background: var(--color-bg-800);
  }
}
